!function(){var e;chrome.runtime&&chrome.runtime.getManifest&&chrome.runtime.getManifest().version,e={settingsFile:"settings.json"};var n=["ru","en","en_US"],t=[{lang:"ru",name:"Русский"},{lang:"en",name:"English"}],i="ru",a=["RUB","USD","EUR"],r=[{curr:"RUB",name:"Рубль"},{curr:"USD",name:"USD"},{curr:"EUR",name:"Euro"}],o="RUB";$.ajaxSetup({timeout:6e4});var c=function(e){return e?chrome.i18n.getMessage(e):""};try{"en"===chrome.i18n.getMessage("@@ui_locale").split("_")[0]&&(o="USD")}catch(e){}function s(e){var n={type:"sendGaData"};e.category&&(n.category=e.category),e.action&&(n.action=e.action),e.label&&(n.label=e.label),chrome.runtime.sendMessage(n,function(e){chrome.runtime.lastError&&chrome.runtime.lastError.message})}chrome.storage&&chrome.storage.local.get({uiCurrency:!1},function(e){!1===e.uiCurrency||-1===a.indexOf(e.uiCurrency)?chrome.storage.local.set({uiCurrency:o}):o=e.uiCurrency,$(".select-row--uiCurrency select").html(""),$.each(r,function(e,n){-1!==a.indexOf(n.curr)&&$(".select-row--uiCurrency select").append('<option value="'+n.curr+'" '+(o===n.curr?" selected":"")+">"+n.name+"</option>")})});var l,u=!1;if(function(e){var a=$.Deferred();function r(r,o){i=r;var s=$.Deferred();o||e?$.getJSON(chrome.extension.getURL("_locales/"+r+"/messages.json")).done(function(e){c=function(n){return e[n]&&e[n].message||chrome.i18n.getMessage(n)},s.resolve("initTranslation done")}).fail(function(){s.resolve("initTranslation fail")}):s.resolve("initTranslation correct language"),s.done(function(){$(".translate").each(function(){$(this).html(c($(this).attr("data-localize")))}),$(".translate--placeholder").each(function(){$(this).attr("placeholder",c($(this).attr("data-localize")))}),$(".ali-plugin-wrap").removeClass("loading"),$(".select-row--uiLanguage select").html(""),$.each(t,function(e,t){-1!==n.indexOf(t.lang)&&$(".select-row--uiLanguage select").append('<option value="'+t.lang+'" '+(i==t.lang?" selected":"")+">"+t.name+"</option>")}),a.resolve(r,"initTranslation done")})}return chrome.storage.local.get({uiLanguage:!1},function(e){var t=chrome.i18n.getMessage("@@ui_locale").split("_")[0],a=i;!1!==e.uiLanguage?r(a=e.uiLanguage,t&&a!==t):(a=void 0!==t&&-1!==n.indexOf(t)?t:chrome.runtime&&chrome.runtime.getManifest().default_locale?chrome.runtime.getManifest().default_locale:"ru",chrome.storage.local.set({uiLanguage:a},function(){r(a,t&&a!==t)}))}),a.promise()}().done(function(){chrome.storage.local.get({extensionId:!1},function(e){var n=$(".alihelper-plugin-settings .settings-form");!1===e.extensionId?n.find(".item--extid").hide():n.find(".foo__extension__id").html(e.extensionId),n.removeClass("loading").find("select").niceSelect()})}),$.fn.serializeObject=function(){var e={},n=this.serializeArray();return $.each(n,function(){void 0!==e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||""}),e},chrome.storage.local.get({uiLanguage:!1,uiCurrency:!1,sellerCheck:!0,comments:!0,search:!0,myali:!0,useful:!0,tracking:!0,imageZoom:!0,raitingOnItemPage:!0,raitingOnLeft:!0,showPush:!0},function(e){$("input[name='sellerCheck']").prop("checked",e.sellerCheck),$("input[name='comments']").prop("checked",e.comments),$("input[name='search']").prop("checked",e.search),$("input[name='myali']").prop("checked",e.myali),$("input[name='useful']").prop("checked",e.useful),$("input[name='tracking']").prop("checked",e.tracking),$("input[name='imageZoom']").prop("checked",e.imageZoom),$("input[name='raitingOnItemPage']").prop("checked",e.raitingOnItemPage),$("input[name='raitingOnLeft']").prop("checked",e.raitingOnLeft),$("input[name='showPush']").prop("checked",e.showPush)}),$("#settingsForm").submit(function(e){var n=$(this).serializeObject(),t={};$.each(["uiLanguage","uiCurrency","sellerCheck","comments","search","myali","useful","tracking","imageZoom","raitingOnItemPage","raitingOnLeft","showPush"],function(e,i){"uiLanguage"==i||"uiCurrency"==i?n.hasOwnProperty(i)&&(t[i]=n[i]):!1===n.hasOwnProperty(i)?t[i]=!1:t[i]=!0}),chrome.storage.local.set(t,function(){u&&chrome.runtime.sendMessage({type:"reloadContentScripts"},function(e){chrome.runtime.lastError&&chrome.runtime.lastError.message}),window.location.reload()}),e.preventDefault()}).find("input, select").change(function(e){"uiLanguage"!=$(e.target).attr("name")&&"uiCurrency"!=$(e.target).attr("name")&&"imageZoom"!=$(e.target).attr("name")&&"raitingOnItemPage"!=$(e.target).attr("name")&&"raitingOnLeft"!=$(e.target).attr("name")||(u=!0);var n=$("#settingsForm");n.find("input").each(function(e,n){$(n).val($(n).prop("checked")?1:0)}),s({category:"Plugin settings",action:"click",label:"Popup settings elem - "+$(e.target).attr("name")+" - "+$(e.target).val()}),n.submit()}),(l=$.Deferred(),chrome.storage.local.get({settingsJson:!1},function(n){!1!==n.settingsJson?(e.settings=n.settingsJson,l.resolve(n.settingsJson)):$.ajax({url:"https://aliexpress-checker.ru/"+e.settingsFile,type:"GET",data:{},crossDomain:!0,async:!0}).done(function(n){e.settings=n,n&&l.resolve(n)}).fail(function(){l.reject()})}),l.promise()).done(function(e){e&&(e.multiCurrencyOn&&($(".ali-plugin-wrap .select-row--uiCurrency").addClass("enabled"),function(e){var n=e.find(".select-row--uiCurrency select");function t(n){"USD"!==n?e.find(".currency_warn").removeClass("hide"):e.find(".currency_warn").addClass("hide")}t(n.val()),n.change(function(){t(n.val())})}($(".ali-plugin-wrap"))))}),$("#howto-link").click(function(e){chrome.runtime.sendMessage({type:"createPromTab",url:"https://aliexpress.com/#helper_howto"}),s({category:"Plugin settings",action:"click",label:"Popup howto link click"}),e.preventDefault()}),chrome.runtime){var g=chrome.runtime.getManifest();g.version&&$(".foo__version__link__number").html(g.version)}s({category:"Plugin settings",action:"show",label:"Popup settings page"}),$(".ali-plugin-wrap .settings-form-title-link").click(function(){s({category:"Plugin settings",action:"click",label:"Popup settings back click"})}),$(".ali-plugin-wrap .ali-support").click(function(){s({category:"Plugin settings",action:"click",label:"Popup settings support link click"})})}();