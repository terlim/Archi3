!function(){var e,t;chrome.runtime&&chrome.runtime.getManifest&&(t=chrome.runtime.getManifest().version),e={settingsFile:"settings.json"};var i=["ru","en","en_US"],a=[{lang:"ru",name:"Русский"},{lang:"en",name:"English"}],r="ru",n=["RUB","USD","EUR"],o=[{curr:"RUB",name:"Рубль"},{curr:"USD",name:"USD"},{curr:"EUR",name:"Euro"}],c="RUB";$.ajaxSetup({timeout:6e4});var l=function(e){return e?chrome.i18n.getMessage(e):""};try{"en"===chrome.i18n.getMessage("@@ui_locale").split("_")[0]&&(c="USD")}catch(e){}function s(e){var t={type:"sendGaData"};e.category&&(t.category=e.category),e.action&&(t.action=e.action),e.label&&(t.label=e.label),chrome.runtime.sendMessage(t,function(e){chrome.runtime.lastError&&chrome.runtime.lastError.message})}function d(e){var t="USD",i=e.cur||e.app_cur;if(+i){var a={1:"USD",2:"RUB",3:"AUD",4:"EUR",5:"MXN",6:"UAH",7:"CAD",8:"TRY",9:"CLP",10:"SGD",11:"CHF",12:"BRL",13:"INR",14:"JPY",15:"IDR",16:"KRW",17:"NZD",18:"SEK"};t=a[i]?a[i]:"USD"}else t=i;return t}function p(e,t,i,a){var r="",n='<span class="curr">',o="</span>",c=!!a&&2;switch(i&&(n="",o=""),e){case"RUB":t<1?(c=!!a&&1,r=l(Math.round(10*t)/10)):(c=!1,r=l(Math.round(t))),r+=" "+n+"р."+o;break;case"GBP":r=n+"£ "+o+l(t);break;case"JPY":r=n+"¥ "+o+l(t);break;case"TRY":r=n+"TL "+o+l(t);break;case"BRL":case"MXN":case"AUD":case"CAD":case"USD":r=n+"$"+o+l(t);break;case"UAH":c=!!a&&1,r=l(Math.round(10*t)/10)+" "+n+"грн"+o;break;case"EUR":r=n+"€ "+o+l(t);break;default:c=!!a&&1,r=n+"$"+o+l(t)}return l(t)?r:"";function l(e){var t="";if(e){!1!==c&&+e&&+e<99999&&(e=(+e).toFixed(c));var i=e.toString().split(".");i&&(t=i[0].replace(/(\d{1,3}(?=(?:\d\d\d)+(?!\d)))/g,"$1 ")+(void 0!==i[1]?"."+i[1]:""))}return t}}function _(e,t){void 0!==e.item.sale_price&&+e.item.sale_price>0?e.item.sale_price:e.item.original_price;var i=0,a=(new Date).setHours(0,0,0,0),r=a,n=u(e),o=0,c=!1;if($.each(n,function(e,t){var l,s,d=new Date(Date.parse(t.date)).setHours(0,0,0,0);if(l=+t.price,s=void 0!==n[e+1]&&+n[e+1].price?+n[e+1].price:l,r=new Date(Date.parse(t.date)).getTime(),t.cached&&(c=!0),i=Math.floor((a-d)/864e5),s!==l)return o=Math.round(100*(l-s))/100,!1}),0!==o||n&&n.length||!e||!e.item||!e.item.priceChange||0===e.item.priceChange||(o=e.item.priceChange),t)return{priceChange:o};var s="",d="",p="";return i>1&&i<7?d=i+" "+function(e,t,i){var a="";a=e%10==1&&e%100!=11?t[0]:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?t[1]:t[2];return i?a.replace("_",e):a}(i,[_("i_history_day_1"),_("i_history_day_2"),_("i_history_day_3")]):i>=7&&i<14?d=_("i_history_week"):i>=14&&i<21?d=_("i_history_two_weeks"):i>=21&&i<31?d=_("i_history_hree_weeks"):i>31&&(d=_("i_history_more_than_month")),o>0||o<0?(o>0&&(p+=" "+_("c_price_tooltip_up")+" "),o<0&&(p+=" "+_("c_price_tooltip_down")+" "),i<=1?(o>0&&(s=_("i_history_up")+" "),o<0&&(s=_("i_history_down")+" "),0===i&&(d=_("i_history_today")),1===i&&(d=_("i_history_yesterday"))):i>1&&i<31?d+=" "+_("i_history_ago"):i>31&&(d=_("i_history_more_than_month"))):(s=_("i_history_none_small")+" ",i>31&&(s=""),p+=" "+_("c_price_tooltip_not_changed2")),{priceChangeTimestamp:r,priceChangeText:s+d,priceChangeTooltipTxt:p,priceChange:o,priceFromCache:c};function _(e){return l(e)}}function u(e){var t,i=[];t=e.item&&e.item.customHistory?e.item.customHistory:e.history?e.history:[];var a,r,n=0;if($.each(t,function(e,o){var c,l,s,p;if(c=o.sale_price||o.original_price||o.price,l=o.date||o.created_at,s=+o.currency_rate,0==+c||!l||t.length>3&&a===c&&r===new Date(l).setHours(0,0,0,0))return!0;a=c,r=new Date(l).setHours(0,0,0,0),p={price:c,date:l,cur:d(o)},s&&(p.currency_rate=s),o.cached&&(p.cached=o.cached),i.push(p),n++}),1===n&&i[0]&&i[0].price){var o=i[0],c=new Date(o.date);c.setDate(c.getDate()-2),i.push({price:o.price,date:c,cur:o.cur}),n++}return i}function m(e){var t=e.onSuccess?e.onSuccess:function(){},i=e.onError?e.onError:function(){};chrome.runtime.sendMessage({type:"sendBgAjaxRequest",params:e.ajaxParams,urlType:e.urlType},function(e){if(chrome.runtime.lastError)n("helperSendBgAjaxRequest runtime error "+chrome.runtime.lastError.message);else try{if(e){var a=e.responseParams,r=e.type;"success"===r?t(a&&a.response):"error"===r?i(a&&a.jqXHR||{},a&&a.textStatus,a&&a.errorThrown):n("helperSendBgAjaxRequest resp status error")}else n("helperSendBgAjaxRequest no response")}catch(e){n("helperSendBgAjaxRequest catch "+(e.message?e.message:""))}function n(e){i({},e||"","")}})}if(chrome.storage&&chrome.storage.local.get({uiCurrency:!1},function(e){!1===e.uiCurrency||-1===n.indexOf(e.uiCurrency)?chrome.storage.local.set({uiCurrency:c}):c=e.uiCurrency,$(".select-row--uiCurrency select").html(""),$.each(o,function(e,t){-1!==n.indexOf(t.curr)&&$(".select-row--uiCurrency select").append('<option value="'+t.curr+'" '+(c===t.curr?" selected":"")+">"+t.name+"</option>")})}),document.body.childElementCount<2||$(".info-404").length>0||-1!==document.title.indexOf("Page Not Found -"))return!1;var h=(new Date).getTime()+"-"+(""+Math.random()).replace(".","");$("body").attr("data-loadCheckTimestamp",h),function(e){var t=$.Deferred();function n(n,o){r=n;var c=$.Deferred();o||e?$.getJSON(chrome.extension.getURL("_locales/"+n+"/messages.json")).done(function(e){l=function(t){return e[t]&&e[t].message||chrome.i18n.getMessage(t)},c.resolve("initTranslation done")}).fail(function(){c.resolve("initTranslation fail")}):c.resolve("initTranslation correct language"),c.done(function(){$(".translate").each(function(){$(this).html(l($(this).attr("data-localize")))}),$(".translate--placeholder").each(function(){$(this).attr("placeholder",l($(this).attr("data-localize")))}),$(".ali-plugin-wrap").removeClass("loading"),$(".select-row--uiLanguage select").html(""),$.each(a,function(e,t){-1!==i.indexOf(t.lang)&&$(".select-row--uiLanguage select").append('<option value="'+t.lang+'" '+(r==t.lang?" selected":"")+">"+t.name+"</option>")}),t.resolve(n,"initTranslation done")})}return chrome.storage.local.get({uiLanguage:!1},function(e){var t=chrome.i18n.getMessage("@@ui_locale").split("_")[0],a=r;!1!==e.uiLanguage?n(a=e.uiLanguage,t&&a!==t):(a=void 0!==t&&-1!==i.indexOf(t)?t:chrome.runtime&&chrome.runtime.getManifest().default_locale?chrome.runtime.getManifest().default_locale:"ru",chrome.storage.local.set({uiLanguage:a},function(){n(a,t&&a!==t)}))}),t.promise()}().done(function(){chrome.storage.local.get({raitingOnItemPage:!0},function(g){var f,v,w;$(".ali-rating-wrap").remove(),!0===g.raitingOnItemPage&&function(){var e=!1;1==+$.cookie("ali-plugin-rait")&&(e=!0);var t='<div data-lang="'+r+'" class="ali-rating-wrap'+(e?" ali-rating-wrap--closed":"")+'"><div id="ali-helper-loader" class="ali-helper-loader'+(e?"":" ali-helper-loader--big")+'" style="width: 100%; text-align: center"><img src="'+chrome.extension.getURL(e?"img/loader-horizontal.gif":"img/loader.gif")+'"></div></div>',i=$("#j-product-action-block"),a=$(".product-main .product-main-wrap .product-info");i.length?i.after(t):a.length?a.append(t):$("#j-bp-banner").after(t)}(),$.when((w=$.Deferred(),chrome.storage.local.get({settingsJson:!1},function(t){!1!==t.settingsJson?(e.settings=t.settingsJson,w.resolve(t.settingsJson)):$.ajax({url:"https://aliexpress-checker.ru/"+e.settingsFile,type:"GET",data:{},crossDomain:!0,async:!0}).done(function(t){e.settings=t,t&&w.resolve(t)}).fail(function(){w.reject()})}),w.promise()),(f=$.Deferred(),v="conf_"+r+".json",chrome.storage.local.get({confJson:!1,configJsonTimeout:!1},function(t){function i(i){$.ajax({url:"https://aliexpress-checker.ru/"+v,type:"GET",data:{},crossDomain:!0,async:!0}).done(function(a){if(a&&"object"==typeof a){var r=t;!1===t.confJson&&(r.confJson={}),!1===t.configJsonTimeout&&(r.configJsonTimeout={}),r.confJson[v]=a,r.configJsonTimeout[v]=(new Date).getTime()+6e5,chrome.storage.local.set(r,function(){e.config=a,i&&f.resolve(a)})}else f.reject()}).fail(function(){f.reject()})}function a(){return!1!==t.confJson&&t.confJson[v]}function r(){e.config=t.confJson[v],f.resolve(t.confJson[v])}e.config?f.resolve(e.config):!1===t.configJsonTimeout||!t.configJsonTimeout[v]||t.configJsonTimeout[v]<(new Date).getTime()||!a()?a()?(r(),i(!1)):i(!0):r()}),f.promise())).then(function(){!function(){$(".translate").each(function(){$(this).html(l($(this).attr("data-localize")))}),$(".translate--placeholder").each(function(){$(this).attr("placeholder",l($(this).attr("data-localize")))});var g=$(".product-main .product-main-wrap .product-info").length>0;f=document.location.href,!(f.toString().match(/deep_link\.htm/g)||f.toString().match(/login\.aliexpress\.com/g)||f.toString().match(/post\.aliexpress\.com/g)||f.toString().match(/s\.click\.aliexpress\.com/g)||!(f.toString().match(/^(http.?:)?\/\/([a-z0-9_\.-]+)?aliexpress\.com\/.*?\-detail\.html/g)||f.toString().match(/^http.?:\/\/([a-z0-9_\.-]+)?aliexpress\.com\/store\/product\//g)||f.toString().match(/^(http.?:)?\/\/([a-z0-9_\.-]+)?aliexpress\.com\/item\//g)||f.toString().match(/^(http.?:)?\/\/([a-zA-Z0-9_\.-]+)?aliexpress\.com\/groupShare\/productDetail(.*?)id=/g)))&&chrome.storage.local.get({extensionId:!1,raitingOnLeft:!0,raitingOnItemPage:!0,uiLanguage:!1,uiCurrency:!1},function(f){var b,y=$("input[id=hid-product-id]").eq(0).val()||$("input[id=buy-now-productId]").eq(0).val(),k=f.uiCurrency||c,x=f.uiLanguage||r,C=e.settings,P=C.multiCurrencyOn,S=!0===C.similarProductsEnabled,T=!0===C.initSimilarOnPageLoad,D=C.similarProductsUpdateThreads?+C.similarProductsUpdateThreads:2,I=C.similarProductsUpdateMaxCnt?+C.similarProductsUpdateMaxCnt:0,M=C.cachedPrices;if(!y)try{if(g){var U=$("body").html().match(/"productId":([0-9]+),"sellerAdminSeq":[0-9]+/);U&&U[1]&&!isNaN(+U[1])&&(y=+U[1])}else{var O=$("#feedback").find("iframe");if(O.length>0){var R=(O.attr("thesrc")||O.attr("src")).split("?");y=w(R[1]).productId}}y||(y=document.location.href.split("?")[0].split("/").slice(-1)[0].replace(/[^\d-]/g,"").split("-").filter(function(e){return""!=e}).slice(-1)[0])}catch(e){throw e}if(!1!==f.extensionId&&y){var E;$("#goods_block_content").addClass("loading"),N()}else{var j=!1===f.extensionId?"no extension id for api":"",L=y?"":"no product id for api",A=!1;($("#signInField").length>0&&$("#expressbuyerlogin").length>0||$("#homepage-link").length>0&&$(".info-404").length>0)&&(A=!0),A||(re(j+L,y,201),!1===f.extensionId&&(N(),f.raitingOnLeft=!1))}var z,B=[],F=[],J=$(".alihelper_plugin_wrap select.my_products_select"),H=(J.val(),[]);function N(){if($("body").attr("data-loadCheckTimestamp")!=h)return!1;!function(e){var t,i,a,r,n,o,c="",d="",p="";function _(e){chrome.storage.local.get({mini_popup_clicks:!1},function(e){chrome.storage.local.set({mini_popup_clicks:!1!==e.mini_popup_clicks?e.mini_popup_clicks+1:1})}),s({category:"Plugin content",action:"click",label:"Mini popup click "+e})}t='<nav><div class="nav_item" id="alihelper_rating_mini"><a class="seller_rating" href="#section-1"><p>'+l("c_rating_title")+'</p><span class="alihelper_rating_result_score"></span></a><span class="price_tooltip loading"><i class="price_tooltip_text price_tooltip_text--price_down">'+l("c_price_tooltip_down")+'</i><i class="price_tooltip_text price_tooltip_text--price_up">'+l("c_price_tooltip_up")+'</i><i class="price_tooltip_text price_tooltip_text--price_not_changed">'+l("c_price_tooltip_not_changed")+'</i></span></div><div class="tabs_wrap" style="width: 0;"></div></nav>',S&&(c='<div id="section-4" class="nav_item"><div class="title_block title_block--similar">'+l("c_similar_goods")+'<div class="select_wrap"><select class="ali_custom_select similar_products_select"><option value="rating" selected>'+l("c_similar_select_rating")+'</option><option value="price">'+l("c_similar_select_price")+'</option></select></div></div><div class="goods_block goods_block--empty goods_block--similar loading" id="similar_block_content"><span class="goods_block_content--no_prod">'+l("c_similar_empty")+'</span></div><p class="similar_info hide">'+l("c_similar_info")+"</div>",d='<div class="nav_item similar_goods_tab"><a class="similar_goods" href="#section-4"></a></div>'),i='<nav><div class="nav_item"><a class="seller_rating" href="#section-1"><p>'+l("c_rating_title")+'</p><span class="alihelper_rating_result_score"></span></a></div><div class="tabs_wrap"><div class="nav_item price_dynamics_tab"><a class="price_dynamics" href="#section-2"></a></div><div class="nav_item my_goods_tab"><a class="my_goods" href="#section-3"></a></div>'+d+'</div><div class="minimize"><span class="minimize_btn closed"></span></div></nav>',a='<span class="setting alihelper_popup_settings_icon"><span class="tooltip_text">'+l("i_extension_settings_small")+"</span></span>",r='<div id="section-1" class="nav_item content-current"><div class="title_block title_block--rating clearfix">'+a+'<div class="rating__scale"><div class="rating__scale__wrap"><div class="rating__scale__fill"></div><div class="rating__scale__value"><span class="rating__scale__num"></span><span class="small">%</span><span class="rating__scale__text"></span></div></div><span class="rating__scale__fill rating__scale__fill--shadow"></span></div>'+l("c_seller_rating")+'</div><div class="instructions_block"><p class="instructions_block_inner"></p></div><div class="information_seller"><ul class="information_seller__list"></ul></div></div>',n='<div id="section-2" class="nav_item"><div class="title_block title_block--price">'+a+l("c_price_dynamics")+'<div class="chart_style-wrap"><div id="alihelperPriceChart" class="alihelper-price-chart chart_style loading"><div><div></div></div>'+l("c_no_data")+'</div></div></div><div class="follow_price_block"><span class="follow_price beh_price"><i class="icon"></i><span class="text">'+l("c_track_price_loading")+'</span></span><p class="follow_price_info">'+l("c_track_price_info")+"</p></div></div>",o='<div id="section-3" class="nav_item"><div class="title_block title_block--watchlist">'+l("c_my_products_title")+'<div class="select_wrap"><select class="ali_custom_select my_products_select"><option value="all">'+l("c_my_products_select_all")+'</option><option value="price_down">'+l("c_my_products_select_price_down")+'</option><option value="price_asc">'+l("c_my_products_select_price_asc")+'</option><option value="seller_rating">'+l("c_my_products_select_seller_rating")+'</option>\x3c!--<option value="recent">'+l("c_my_products_select_recent")+'</option>--\x3e</select></div><div class="alihelper_watchlist_add_product follow_price"><i class="icon"></i><div class="follow_price_tooltip">'+l("c_track_price_watchlist")+'</div></div></div><div class="goods_block goods_block--empty loading" id="goods_block_content"><span class="goods_block_content--no_prod">'+l("c_my_products_empty")+'</span></div>\x3c!--<div class="pagination_block" id="goods_block_pagination"></div>--\x3e</div>',p="",$(".alihelper_plugin_wrap").remove(),!0===f.raitingOnLeft&&(p=$('<div data-lang="'+x+'" class="alihelper_plugin_wrap alihelper_plugin_wrap--loading"><div class="plugin_body plugin_body--button open">'+t+'</div><div class="plugin_body plugin_body--content hide">'+i+'<div class="content-wrap">'+r+n+o+c+"</div></div></div>"),$("body").append(p)),$("#alihelper_rating_mini").click(function(e){_("rating")}).find(".price_tooltip").click(function(e){_("price tooltip"),e.preventDefault(),e.stopPropagation()});var u=$('<span class="toggle_button toggle_button--close"></span>').html(l("c_a_rollup")).hide().click(function(){s({category:"Plugin content",action:"click",label:"Toggle rating"})}),m=$(".ali-rating-wrap");m.find(".rating_wrap, .toggle_button").remove(),m.append(u).append('<div class="rating rating_wrap"></div>'),p&&($(window).on("tabShowed",function(e){p.find(".title_block--price").is(":visible")&&s({category:"Plugin content",action:"click",label:"Price dynamics tab show"}),p.find("#goods_block_content").is(":visible")&&s({category:"Plugin content",action:"click",label:"My goods tab show"})}),function(){if(!S)return!1;chrome.storage.local.get({similarTooltipShowed:!1,similarTooltipClosed:!1},function(e){!1===e.similarTooltipClosed&&function(){var e,t=$('<span class="similar_tooltip similar_tooltip--'+x+'">'+l("i_similar_tooltip")+"</span>"),i=$('<span class="similar_tooltip_close">&times;</span>').click(function(){r(),s({category:"Plugin content",action:"click",label:"Similar tooltip hide"})}),a=!0;function r(){a=!1,clearTimeout(e),t.hide(),chrome.storage.local.set({similarTooltipClosed:!0})}t.append(i),t.click(function(){p.find(".similar_goods_tab").trigger("click"),r()}),p.find(".tabs_wrap").append(t),$(window).on("tabShowed",function(i){!p.find(".plugin_body--content").hasClass("hide")&&a&&(e=setTimeout(function(){a&&(chrome.storage.local.set({similarTooltipShowed:!0}),t.addClass("similar_tooltip--showed"),a=!1)},800)),p.find(".similar_goods_tab").hasClass("tab-current")&&r()})}()})}()),e()}(function(){if(function(){var r=e.config;if(!r)return!1;!0===C.ratingEnabled&&(!0!==f.raitingOnLeft&&!0!==f.raitingOnItemPage||function(){var e,t=$.Deferred(),i=$("#feedback").find("iframe");if(i.length||g||t.resolve(!1),g){var a=$("body").html().match(/"productId":[0-9]+,"sellerAdminSeq":([0-9]+)/);a&&a[1]&&!isNaN(+a[1])&&(e=+a[1])}else if(i.length>0){var n,o=void 0!==i.attr("thesrc")?i.attr("thesrc").replace("productEvaluation","evaluationDetail"):i.attr("thesrc"),c=o.split("?");n=c.length>1&&w(c[1]),e=n&&n.ownerMemberId}return e?chrome.runtime.sendMessage({type:"getSeller",seller_id:e,prodId:y,lang:x},function(i){chrome.runtime.lastError&&chrome.runtime.lastError.message;var a={};i&&(a=i);var n,o,c,s=a&&a.rate?a.rate:{},d=s&&s.result_score?s.result_score:0,p="",_="";!function(){var e=s&&s.text?s.text:[];if(e.success){var t="good";m()&&(t="neutral"),e.success&&$(e.success).each(function(e,i){p+="<li class='information_seller__item information_seller__item--"+t+"'><span class='information_seller__item__text'>"+i+"</span></li>",_+="<li class='seller-info__item'><span class=\"icon icon--check icon--check--"+t+'"></span><span class="seller-info__item__text">'+i+"</li>"})}e.warning&&$(e.warning).each(function(e,t){p+='<li class="information_seller__item information_seller__item--neutral"><span class="information_seller__item__text">'+t+"</span></li>",_+='<li class="seller-info__item"><span class="icon icon--check icon--check--neutral"></span><span class="seller-info__item__text">'+t+"</li>"}),e.error&&$(e.error).each(function(e,t){p+='<li class="information_seller__item information_seller__item--bad"><span class="information_seller__item__text">'+t+"</span></li>",_+='<li class="seller-info__item"><span class="icon icon--check icon--check--bad"></span><span class="seller-info__item__text">'+t+"</li>"})}(),!0===f.raitingOnItemPage&&function(){var e=$(".detail");if(e.children(".col-main").length&&e.children(".col-sub").length)return!1;s||(s={}),s.summary||(s.summary=[]);var t=s.summary.class||"",i=s.summary.small_text||"",a=s.summary.text||"",n=d<20?d+6:d,o='<div class="rating__scale '+(m()?" "+r.low_level_trust.class:"")+" "+t+'"><div class="rating__scale__wrap"><div class="rating__scale__fill" style="width: '+n+'%;"><div class="rating__scale__value">'+d+'<span class="small">%</span><span class="rating__scale__text">'+i+'</span></div></div></div><span class="rating__scale__fill rating__scale__fill--shadow" style="width: '+n+'%;"></span></div>',c='<div class="rating__title">'+l("c_seller_rating_title")+'</div><p class="rating__info">'+a+"</p>",p='<ul class="seller-info">'+_+"</ul>",u=$(".ali-rating-wrap");u.find(".ali-helper-loader").remove(),u.find(".toggle_button").show(),u.find(".rating_wrap").html(o+c+p)}(),!0===f.raitingOnLeft&&(n=s.summary||[],o=n.class,(c=$(".alihelper_plugin_wrap")).addClass("rating_calculated alihelper_plugin_wrap__"+(o||"rating--none")),c.find(".alihelper_rating_result_score").html(d+"%"),c.find(".title_block--rating").addClass(o),c.find(".title_block--rating .rating__scale__text").html(m()?r.low_level_trust.text:n.small_text),c.find(".rating__scale").attr("data-percent",d),c.find(".information_seller__list").html(p),c.find(".instructions_block_inner").html(n.text),c.find(".plugin_body--button").addClass("open").removeClass("hide")),t.resolve(!!i,e);var u=$(".alihelper_plugin_wrap");function m(){return d<=r.calculate.min_feedback_to_calculate||!a}u.removeClass("alihelper_plugin_wrap--loading")}):t.resolve(!1),t.promise()}().done(function(t,i){if(function(){e.config;var t=!1;function i(){!t&&$(".at-theme-default .at-panel-wrapper, .at-theme-light .at-panel-wrapper").length>0&&(t=!0,$(".alihelper_plugin_wrap .plugin_body").css("bottom","+=70px"))}setTimeout(i,100),setTimeout(i,500),setTimeout(i,1e3);var a=!1,r=$(".ali-rating-wrap"),n=r.find(".toggle_button"),o={path:"/"};function c(){window.scrollBy(0,1);var e=l("i_show"),t=l("i_hide");n.hasClass("toggle_button--close")?(r.addClass("ali-rating-wrap--closed"),n.removeClass("toggle_button--close").addClass("toggle_button--open").text(e),$.cookie("ali-plugin-rait",1,o)):(r.removeClass("ali-rating-wrap--closed"),n.removeClass("toggle_button--open").addClass("toggle_button--close").text(t),$.removeCookie("ali-plugin-rait",o)),window.scrollBy(0,-1)}function s(){if(a)return!1;var e=$(".alihelper_plugin_wrap .title_block--rating"),t=e.find(".rating__scale");t.is(":visible")&&(t.each(function(e,i){var a=+$(i).attr("data-percent");t.find(".rating__scale__fill").animate({width:a+"%"},{duration:300,easing:"swing"}),0!==a?t.find(".rating__scale__num").html(a):t.find(".rating__scale__value .small").hide()}),a=!0)}document.documentElement.setAttribute("lang",x),n.click(function(){c()}),1==$.cookie("ali-plugin-rait")&&c(),r.show(),function(){var e=$(".alihelper_plugin_wrap");if(e.hasClass("tabs_inited"))return!1;!function(t){[].slice.call(document.querySelectorAll(".alihelper_plugin_wrap .plugin_body--content")).forEach(function(e){b=new CBPFWTabs(e)}),$(".alihelper_plugin_wrap .content-wrap > .nav_item").removeClass("ready"),e.find(".price_tooltip").click(function(t){e.find(".plugin_body--button").click(),b._show(1),t.preventDefault(),t.stopPropagation()}),t()}(function(){e.addClass("alihelper_plugin_wrap--done"),e.find(".price_tooltip--done").length>0&&e.removeClass("alihelper_plugin_wrap--loading"),e.find(".plugin_body--button").click(function(t){return e.find(".plugin_body--content").removeClass("hide"),b._show(0),!a&&s(),t.preventDefault(),!1}),$(window).on("tabShowed",function(e){!a&&s()}),e.find(".plugin_body--content .minimize_btn").click(function(t){return e.find(".plugin_body--content").addClass("hide"),t.preventDefault(),!1}),$(document).on("click",function(e){var t=$(".alihelper_plugin_wrap");if(!$(e.target).closest(".alihelper_plugin_wrap .plugin_body--content").length&&!$(e.target).closest(".alihelper_plugin_wrap .plugin_body--button").length&&!$(e.target).is($(".ali-rating-wrap .toggle_button"))){var i=t.find(".plugin_body--content");i.is(":visible")&&i.addClass("hide")}}),"#helper_my_products"==window.location.hash?setTimeout(function(){$(".alihelper_plugin_wrap .plugin_body--button").click(),b._show(2)},200):"#open_price_history"==window.location.hash&&($(".alihelper_plugin_wrap .plugin_body--button").click(),b._show(1)),e.addClass("tabs_inited")})}()}(),!t){var a='<p class="rating__info rating_no_data_error">'+l("c_rating_no_data")+"</p>",r=$(".alihelper_plugin_wrap");$(".ali-rating-wrap .rating_wrap").html(a),r.hasClass("alihelper_plugin_wrap--loading")&&r.removeClass("alihelper_plugin_wrap--loading"),r.find(".information_seller, .rating__scale").hide(),r.find(".instructions_block_inner").html(a),r.find(".alihelper_rating_result_score").addClass("no_data").html(" --")}}),$(".alihelper_plugin_wrap .content-wrap > .nav_item").addClass("ready"),!0===f.raitingOnLeft&&function(){$(".alihelper_settings_wrap").remove();var e=$('<div class="alihelper_settings_wrap alihelper_content_popup_wrap alihelper_content_popup_wrap--settings"></div>').hide(),r="",c="";i.length>1&&(r+='<div class="select-row select-row--uiLanguage"><label class="select-row__label" for="uiLanguage">'+m("l_language")+'</label><select class="select-row__select" id="uiLanguage" name="uiLanguage">',$.each(a,function(e,t){-1!==i.indexOf(t.lang)&&(r+='<option value="'+t.lang+'" '+(x==t.lang?" selected":"")+">"+t.name+"</option>")}),r+="",r+="</select></div>"),n.length>1&&P&&(c+='<div class="select-row select-row--uiCurrency enabled"><label class="select-row__label" for="uiCurrency">'+m("l_currency")+'</label><select class="select-row__select" id="uiCurrency" name="uiCurrency">',$.each(o,function(e,t){-1!==n.indexOf(t.curr)&&(c+='<option value="'+t.curr+'" '+(k==t.curr?" selected":"")+">"+t.name+"</option>")}),c+="",c+='</select><p class="currency_warn hide">'+m("i_currency_warn")+"</p></div>");var d=$('<div class="alihelper-plugin-settings alihelper_content_popup alihelper_content_popup--settings"><form class="settings-form loading"><div class="settings-form-title settings-form-title--main"><span class="settings-form-title-text">'+m("i_extension_settings")+'</span></div><div class="settings-form-content clearfix"><div class="settings-form-item settings-form-item--general"><div class="settings-form-title settings-form-title"><span class="icon icon-settings icon-settings--general"></span>'+m("i_general_settings")+'</div><div class="settings-form-item-fields"><div class="checkbox-row"><input type="checkbox" class="checkbox-row__input checkbox_row_label_3" id="third" value="" name="search"><label class="checkbox-row__label" for="third">'+m("l_show_quicq_search")+'</label></div><div class="checkbox-row"><input type="checkbox" class="checkbox-row__input checkbox_row_label_5" id="dfs" value="" name="useful"><label class="checkbox-row__label" for="dfs">'+m("l_show_useful_sections")+'</label></div><div class="checkbox-row"><input type="checkbox" class="checkbox-row__input checkbox_row_label_6" id="jre" value="" name="tracking"><label class="checkbox-row__label" for="jre">'+m("l_show_tracking")+'</label></div><div class="checkbox-row"><input type="checkbox" class="checkbox-row__input checkbox_row_label_7" id="imz" value="" name="imageZoom"><label class="checkbox-row__label" for="imz">'+m("l_image_zoom")+'</label></div><div class="checkbox-row"><input type="checkbox" class="checkbox-row__input checkbox_row_label_8" id="rop" value="" name="raitingOnItemPage"><label class="checkbox-row__label" for="rop">'+m("l_show_extended_rating")+'</label></div><div class="checkbox-row"><input type="checkbox" class="checkbox-row__input checkbox_row_label_9" id="lr" value="" name="raitingOnLeft"><label class="checkbox-row__label" for="lr">'+m("l_show_mini_rating")+'</label></div></div></div><div class="settings-form-item settings-form-item--localization"><div class="settings-form-title"><span class="icon icon-settings icon-settings--localization"></span>'+m("i_localization")+'</div><div class="settings-form-item-fields">'+r+c+'</div></div><div class="settings-form-item settings-form-item--notify"><div class="settings-form-title"><span class="icon icon-settings icon-settings--notify"></span>'+m("i_notify")+'</div><div class="settings-form-item-fields"><div class="checkbox-row"><input type="checkbox" class="checkbox-row__input checkbox_row_label_10" id="push" value="" name="showPush"><label class="checkbox-row__label" for="push">'+m("l_show_push")+'</label></div></div></div></div><div class="settings-form-bottom clearfix"><div class="settings-form-bottom-links"><span class="link howto" id="howto-link">'+m("a_howto")+'</span><span class="link ali-support">'+m("a_support_complains")+'</span></div><div class="settings-form-bottom-info"><p class="item item--version"><span>'+m("i_alihelper_name")+'</span> <span class="foo__version__link__number">'+t+"</span></p>"+(f.extensionId?'<p class="item item--extid"><span>'+m("i_extid")+'</span> <span class="foo__extension__id">'+f.extensionId+"</span></p>":"")+'</div><a class="button button--orange settings-form-bottom-button settings-form-bottom-button--save">'+m("a_save")+"</a></div></form></div>");d.find(".settings-form-bottom-links .ali-support").click(function(e){window.open("http://aliexpress-helper.ru/#support")}),d.find("select").niceSelect(),e.click(function(t){e.hide(),t.stopPropagation()}).html(d);var p=$('<span class="alihelper_settings_close">&times;</span>').click(function(){e.hide()}),_={};d.find(".settings-form-bottom-button--save").click(function(){chrome.storage.local.set(_,function(){s({category:"Plugin settings",action:"click",label:"Content submit"}),window.location.reload()})});var u=e.find(".settings-form").click(function(e){e.stopPropagation()}).prepend(p);function m(e){return l(e)}u.find(".settings-form-bottom-links .howto").click(function(){s({category:"Plugin settings",action:"click",label:"Content howto link click"}),v()}),u.find(".settings-form-bottom-links .ali-support").click(function(){s({category:"Plugin settings",action:"click",label:"Content support link click"})}),chrome.storage.local.get({sellerCheck:!0,comments:!0,search:!0,myali:!0,useful:!0,tracking:!0,imageZoom:!0,raitingOnItemPage:!0,raitingOnLeft:!0,showPush:!0},function(e){$.each(e,function(e,t){$("input[name='"+e+"']").prop("checked",t)})}),u.submit(function(e){var t=$(this).serializeObject(),i={};$.each(["uiLanguage","uiCurrency","sellerCheck","comments","search","myali","useful","tracking","imageZoom","raitingOnItemPage","raitingOnLeft","showPush"],function(e,a){"uiLanguage"==a||"uiCurrency"==a?t.hasOwnProperty(a)&&(i[a]=t[a]):!1===t.hasOwnProperty(a)?i[a]=!1:i[a]=!0}),chrome.storage.local.set(i,function(){}),e.preventDefault()}).find("input, select").change(function(e){u.find("input").each(function(e,t){$(t).val($(t).prop("checked")?1:0)}),s({category:"Plugin settings",action:"click",label:"Content settings elem - "+$(e.target).attr("name")+" - "+$(e.target).val()}),u.submit()}),function(e){var t=e.find(".select-row--uiCurrency select");function i(t){"USD"!==t?e.find(".currency_warn").removeClass("hide"):e.find(".currency_warn").addClass("hide")}i(t.val()),t.change(function(){i(t.val())})}(u),$("body").append(e),u.removeClass("loading"),$(".alihelper_popup_settings_icon").click(function(t){e.show(),s({category:"Plugin content",action:"click",label:"Settings link click"}),t.preventDefault(),t.stopPropagation()}),$.fn.serializeObject=function(){var e={},t=this.serializeArray();return $.each(t,function(){void 0!==e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||""}),e}}())}(),!0===f.raitingOnLeft){(E=$(".follow_price_block .beh_price, .alihelper_watchlist_add_product")).addClass("follow_price--loading");var r=$.Deferred();function c(t,i){var a=$("#alihelperPriceChart"),r=e.config;if(!t||!r||a.hasClass("inited")||!a.is(":visible"))return!1;var n,o,c,s,_=u("USD");function u(e){var t=e||$("[itemProp=priceCurrency]").attr("content")||$("#switcher-info").find(".currency").html()||"";switch(t){case"RUB":_={val:"р.",format:"%'.1f р."};break;case"GBP":_={val:"£",format:"£ %'.2f"};break;case"JPY":_={val:"¥",format:"¥ %'.2f"};break;case"TRY":_={val:"TL",format:"TL %'.2f"};break;case"BRL":case"MXN":case"AUD":case"CAD":case"USD":_={val:"$",format:"$%'.2f"};break;case"UAH":_={val:"грн.",format:"%'.1f грн."};break;case"EUR":_={val:"€",format:"€ %'.2f"};break;default:_={val:"$",format:"$%'.2f"}}return _}t&&t.length>1&&(n=function(e){if(void 0!==e&&(e.data&&e.data.length<2||!e.data&&e.length<2))return!1;if(a.html("").removeClass("loading"),$.jqplot("alihelperPriceChart",[e.data],(r=(t=e).data&&function(e){var t,i,a,r,n;e.length>=12?(t=4,i=1,a=1,r=3,n=1,$("#alihelperPriceChart").addClass("mini_bullets")):(t=6,i=3,a=3,r=3,n=2);var o=[{backgroundColor:"#ff9900",strokeColor:"#fff1e8",outlineColor:"#de3400",shadowColor:"rgba(236, 242, 211, 0.9)",size:t,shadowSize:i,strokeSize:a,outlineSize:r,lineColor:"#b5c78a",lineWidth:n},{backgroundColor:"#6bcd6b",strokeColor:"#fff1e8",outlineColor:"#29a229",shadowColor:"rgba(236, 242, 211, 0.9)",size:t,shadowSize:i,strokeSize:a,outlineSize:r,lineColor:"#b5c78a",lineWidth:n}];return{show:!0,color:"#6bcd6b",markerTypes:function(e){for(var t=[],i=e.length;i--;)void 0!==e[i-1]&&void 0!==e[i]&&i>1&&e[i-1]&&e[i][1]>e[i-1][1]?t.push(0):t.push(1);return t}(e),markersArray:o,size:6,style:"custom"}}(t.data),{grid:{gridLineWidth:1,gridLineColor:"rgb(235,235,235)",drawGridlines:!0},gridOffset:10,gridPadding:{right:0,left:0,top:5,bottom:0},seriesDefaults:{showMarker:!0,color:"#9dbc5b",shadow:!1,pointLabels:{stackedValue:!0,show:!0,formatString:_.format,edgeTolerance:12,labelsFromSeries:!0,seriesLabelIndex:3,hideZeros:!0},markerRenderer:$.jqplot.MarkerRendererAli,markerOptions:{show:r.show,color:r.color,markerTypes:r.markerTypes,markersArray:r.markersArray,size:r.size,style:r.style}},axes:{xaxis:{renderer:$.jqplot.LinearAxisRenderer,ticks:t.data,tickOptions:{formatString:_.format}},yaxis:{min:t.interval.min,max:t.interval.max,show:!1,tickOptions:{formatString:_.format}}},highlighter:{show:!0,sizeAdjust:1,tooltipLocation:"n",tooltipOffset:11,removeFirst:!0,elemsToShow:[2,1],formatString:'<span class="date item">%s</span><span class="price item">%s</span>',markerRenderer:new $.jqplot.MarkerRendererAli({show:r.show,color:r.color,markerTypes:r.markerTypes,markersArray:r.markersArray,size:r.size,style:r.style,manualPos:!0})}})),a.addClass("inited"),!i)return!1;var t,r,n,o,c,s,u,m,h=i&&i.item,g=h.sale_price&&+h.sale_price||h.original_price&&+h.original_price,f=h.priceChange,v="";if(Math.abs(f)>0){if(n=l(f>0?"c_increased":"c_decreased"),c=g,s=!0,u=(o=f)/((o>0?+c-Math.abs(o):+c+Math.abs(o))/100),m=Math.abs(Math.round(10*u.toFixed(1))/10),-1!==(v=s?m+"%":m).indexOf("NaN"))return re("droppedStr is NaN",y,211),!1;n&&a.after($('<div class="price-status price-status--'+(f>0?"increase":"decrease")+'">    <span class="status-text">'+n+"</span>"+(Math.abs(f)>0?'    <div class="price-status-val '+(f>0?"increase":"decrease")+'">        <span class="price-val '+(f>0?"increase":"decrease")+'">'+p(d(h),Math.abs(f))+'</span>        <span class="percent"> / '+v+"</span>    </div>":"")+"</div>"))}},o=t,c=0,s=0,function(){for(var e=o.length;e--;)0==o[e].price&&o.splice(e,1);o.length>=(r.max_points_in_diagram||15)&&o.splice(r.max_points_in_diagram||15);for(var t=[],i=o.length/5.5,a=o.length;a--;){var l=o[a].price,d=o[a].date,p=o[a].cur?o[a].cur:"",m=new Date(d).toLocaleString(x,{month:"short",day:"numeric"}).replace(".","");a==o.length-1?(c=s=l,t[a+2]=[a+2+i,l,m,""],t[a+1]=[a+2,l,m,l],p&&(_=u(p))):0==a?(t[1]=[a+2,l,m,l],t[0]=[2-i,l,m,""]):t[a+1]=[a+2,l,m,""],l<c&&(c=l),l>s&&(s=l)}t.reverse(),c==s?(c-=c/3,s+=s/2.6):s+=(s-(c-=(s-c)/3))/2.6;var h=0;$.each(t,function(e,t){t&&h++}),t.length=h,n({data:t,interval:{min:c,max:s}})}())}!function(){if(!S)return!1;var e,t,i=$(".alihelper_plugin_wrap"),a=i.find(".title_block--similar"),o=i.find("#similar_block_content"),c=a.find(".similar_count"),u=$(".alihelper_plugin_wrap select.similar_products_select"),h=$('<span class="goods_block_content--no_prod">'+l("c_similar_empty")+"</span>"),f=$('<span class="goods_block_content--no_prod goods_block_content--no_prod--no_data">'+l("c_similar_error")+"</span>"),v=i.find(".similar_info"),w=!1,b=!1,C={},P=[];function M(){var a=i.find("#similar_block_content");a.data("inited")||b||(r.done(function(i){function r(e){a.html(e?h:f),a.removeClass("loading"),e||a.addClass("goods_block--error"),v.addClass("hide")}u.not(".inited").niceSelect(),u.next(".similar_products_select").addClass("disabled"),t=i,function(t){if(y){var i,a,r,n,o=$("body").html(),c=30,l=15,s=-1!==document.location.href.indexOf("mall.aliexpress");if(n=s?{recommendType:"",scenario:"pcTmallDetailBottomSimilar",shipToCountry:"ru",locale:"ru_RU"}:{recommendType:"toOtherSeller",scenario:"pcDetailBottomMoreOtherSeller"},g){var d=o.match(/"recommendModule":{"categoryId":([0-9]+),"companyId":([0-9]+)(.*?)"name":"RecommendModule","productId":([0-9]+),"storeNum":([0-9]+)/);d&&(n.companyId=d[2],n.categoryId=d[1],n.shopId=d[5]),k&&(e=k.toUpperCase(),n.currency=k.toUpperCase())}else i=o.match(/([?&]?window\.runParams\.companyId)="([0-9]*)"/),a=o.match(/([?&]?window\.runParams\.categoryId)="([0-9]*)"/),r=o.match(/([?&]?window\.runParams\.shopId)="([0-9]*)"/),e||(e=o.match(/([?&]?window\.runParams\.currencyCode)="([a-zA-Z]*)"/))&&e[2]&&(e=e[2]);n.currentItemList=y,n.offset=0,n.limit=c,i&&i[2]&&(n.companyId=i[2]),a&&a[2]&&(n.categoryId=a[2]),r&&r[2]&&(n.shopId=r[2]);var p=0;function _(e){e&&0===e.length&&(e=!1);var i={productId:y,sceneId:3035};function a(i){try{var a=[],r=!1;function n(e){e&&-1===a.indexOf(e)&&a.push(e)}e&&e.length>0&&e.map(n),i.ids&&i.ids.length>0&&i.ids.map(n),i.error&&(r=i.error),a.length>0?(t(a),r&&re(r,y,"similarFromAli")):h(r||"empty merge")}catch(e){h("merge catch")}}n.categoryId&&(i.categoryId=n.categoryId),n.companyId&&(i.companyId=n.companyId),p=0,function t(){p++,m({urlType:"oldSimilarProducts",ajaxParams:{type:"get",contentType:"application/json",crossDomain:!0,cache:!0,async:!0,data:i},onSuccess:function(t){try{if(t){"string"==typeof t&&(t=JSON.parse(t));var i=[];if(t[0]&&t[0].recommendDTOList&&$.each(t[0].recommendDTOList,function(e,t){t.productId&&-1===i.indexOf(t.productId)&&i.push(t.productId),t.productId&&C&&!C[t.productId]&&t.localPrice&&(C[t.productId]={price:u(t.localPrice),priceStr:t.localPrice})}),0!==i.length||e){if(e&&e.length>0){var r=0;e.length>l&&(r=l),i.length>c-r&&(i.length=c-r),i.length+r<c&&(r=c-i.length),e.length>r&&(e.length=r)}a({ids:i})}else h("old and new variant, no prods")}else a({error:"old variant, empty"})}catch(e){a({error:"old variant, catch"})}},onError:function(e,i,r){p<3&&0===e.status&&0===e.readyState?setTimeout(t,1e3):a({error:"old variant, ajax error "+(i||"")})}})}()}function u(t){if(!t)return t;switch(e){case"EUR":case"RUB":case"BRL":case"UAH":case"PLN":t=parseFloat(t.replace(".","").replace(",",".").replace(/[^\d.-]/g,""));break;case"INR":t=parseFloat(t.replace(". "," ").replace(",","").replace(/[^\d.-]/g,""));break;case"CLP":t=parseFloat(t.replace(",","").replace(/[^\d.-]/g,""));break;default:t=parseFloat(t.replace(/[^\d.-]/g,""))}return t}!function e(){p++,m({urlType:"newSimilarProducts",ajaxParams:{type:"get",contentType:"application/json",crossDomain:!0,cache:!1,async:!0,data:n},onSuccess:function(e){try{if(e)if("string"==typeof e&&(e=JSON.parse(e)),e.results&&0!==e.results.length){var i=[];$.each(e.results,function(e,t){t.productId&&-1===i.indexOf(t.productId)&&(i.push(t.productId),C[t.productId]={price:u(t.minPrice||t.oriMinPrice),priceStr:t.minPrice||t.oriMinPrice})}),g?i.length>0?t(i):h("new variant on new page, no ids",!0):s?_(i):i.length>0?i.length>=l?t(i):_(i):h("new variant, no ids",!0)}else h("new variant, no results",!0);else h("new variant, no response",!0)}catch(e){h("new variant, catch",!0)}},onError:function(t,i,a){p<3&&0===t.status&&0===t.readyState?setTimeout(e,1e3):h("new variant, ajax error "+(i||""),!0)}})}()}else h("no prodId");function h(e,i){re(e,y,210,{message:"product_data.similar.error",params:{error:e,item:y}}),i?_():t(!1)}b=!0}(function(e){var t,i;e&&e.length>0?(t=function(t){"ajax_error"===t||"object"!=typeof t||!1===t?r(!1===t):Object.keys(t).length>0?R(t,function(t){O(t),U(e,t)}):U(e,t)},i={type:"getProducts",ids:e,currency:k,lang:x},chrome.runtime.sendMessage(i,function(e){chrome.runtime.lastError&&chrome.runtime.lastError.message,t(e)})):r(!0)})}),a.data("inited",!0))}function U(e,t){var i={},a=I,r=D,n=0;if(!I||0===I)return!1;$.each(e,function(e,r){if(n>=a)return!1;t&&void 0===t[r]&&(i[r]=r,n++)}),function e(){var t={},a=Object.keys(i).length,n=a<r?a:r,o=0;if(0===a||T&&w)return!1;$.each(i,function(a,r){if(o>=n)return!1;ee({cb:function(a){a&&a.item?t[r]=a.item:--n,delete i[r],Object.keys(t).length>=n&&R(t,function(t){T&&!w&&O(t,!0),e()})},prodId:r,isSimilar:!0}),o++})}()}function O(e,i){var a=[];e&&$.each(e,function(e,t){a.push(t)}),P=P.concat(a),function(e){var i=t&&t.productData,a=i&&i.item&&(i.item.sale_price||i.item.original_price),r=P;function n(e){var t=!1;if(o.off("mousedown.deep click.deep auxclick.deep"),e&&e.length>0){var i=$(u).val();o.html(""),e=function(e){for(var t=e.length,i=[],a=0;a<t;a++){var r=e[a];if(r.id&&(r.title||""===r.title)&&r.image_url){var n=d({app_cur:r.app_cur}),o=_({item:r}),c=(o.priceChange,{id:r.id,url:r.url,image_url:r.image_url,title:r.title,sale_price:r.sale_price,original_price:r.original_price,currency:n,seller_rating:void 0!==r.seller&&r.seller&&void 0!==r.seller.score?r.seller.score:null});if(r.promUrl&&(c.promUrl=r.promUrl),r.seller){var l=r.seller.rate;r.seller.class?c.rating_class=r.seller.class:l&&l.summary&&l.summary.class?c.rating_class=l.summary.class:c.rating_class=null}i.push(c)}}return i}(e),"rating"===i&&e.sort(function(e,t){return+e.seller_rating>+t.seller_rating?-1:+e.seller_rating<+t.seller_rating?1:0}),"price"===i&&e.sort(function(e,t){var i=e.sale_price?e.sale_price:e.original_price,a=t.sale_price?t.sale_price:t.original_price;return+i<+a?-1:+i>+a?1:0});var r="";e?$.each(e,function(e,t){var i=t.sale_price||t.original_price,n=p(t.currency,i,!1,!0),o=t.seller_rating,c=t.rating_class||(o>=76?"rating--hight":o>=50?"rating--medium":"rating--low"),s=null!==o?'<span class="rating '+c+'"><i class="rating_tooltip_text">'+l("c_seller_rating_clear")+"</i>"+o+"%</span>":"",d=t.promUrl?' data-prom="1" ':"";r+='<a href="'+(t.promUrl||t.url)+'"'+d+' data-href="'+t.url+'" class="similar_item" title="'+t.title.replace('"',"“")+'" target="_blank">    <div class="img-wrap img-wrap--loading">        <img class="img" src="'+t.image_url+'" alt="'+t.title+'">    </div>    <div class="bot">        <span class="price_str price_str--'+(a&&i>a?"more":"less")+'"><span class="price price--'+c+'">'+n+"</span></span>"+s+"    </div></a>"}):t=!0}else t=!0;o.removeClass("loading"),t?(o.html(h),v.addClass("hide")):(o.html(r).removeClass("goods_block--empty"),o.on("mousedown.deep",".similar_item",function(){var e=$(this);chrome.storage.local.get({cashbackUser:!1},function(t){!1!==t.cashbackUser&&e.attr("href",e.attr("data-href")).attr("data-prom","")})}).on("click.deep auxclick.deep",".similar_item",function(e){var t=$(this);if("auxclick"===e.type&&2!==e.which)return!0;t.attr("href")&&t.attr("href",t.attr("href").replace(/\?spm=([^#&]*)&/g,"?")),"1"===t.attr("data-prom")&&chrome.runtime.sendMessage({type:"sendRedirectStat",promUrl:t.attr("href"),tabUrl:t.attr("data-href")})}),o.find(".img").off("load").one("load",function(){$(this).parent(".img-wrap").removeClass("img-wrap--loading")}).each(function(){this.complete&&$(this).load()}),c.html(" ("+e.length+")"),o.hasClass("ss-container")?SimpleScrollbar.reInitEl(o[0]):SimpleScrollbar.initEl(o[0]),v.removeClass("hide")),i&&o.removeClass("filter--price filter--rating").addClass("filter--"+i)}u.next(".similar_products_select").removeClass("disabled"),n(r),e||($(u).on("change",function(){n(P),s({category:"Plugin content",action:"show",label:"Similar select filter "+u.find("option:selected").text()})}),o.off("click.similar auxclick.similar").on("click.similar auxclick.similar",".similar_item",function(e){s({category:"Plugin content",action:"click",label:"Similar product click"})}))}(i)}function R(t,i){Q(t,function(t){(function(t){var i=$.Deferred();try{var a=$("body").html(),r=a.match(/([?&]?window\.runParams\.baseCurrencyCode)="([a-zA-Z]*)"/),o=a.match(/([?&]?window\.runParams\.currencyRate)="([0-9,.]*)"/);function c(){$.each(t,function(e,t){t.price_source&&t.old_price}),i.resolve(t),function(){var e={},i=[];if($.each(t,function(t,a){var r=+a.sale_price>10?.1:.05;"RUB"===k&&(r=2),a.old_price&&Math.abs(+a.sale_price-+a.old_price)>r&&(e[t]={old:+a.old_price,new:+a.sale_price},i.push(t))}),i.length<=0)return!1;var a={type:"updateProductsArray",ids:i,prodId:y,currency:k,lang:x};chrome.runtime.sendMessage(a,function(){chrome.runtime.lastError&&chrome.runtime.lastError.message})}()}e||(e=a.match(/([?&]?window\.runParams\.currencyCode)="([a-zA-Z]*)"/))&&e[2]&&(e=e[2]),r&&r[2]&&(r=r[2]),o&&o[2]&&(o=+o[2]),r&&e&&o||g?k===e||g?($.each(t,function(e,i){C[e]&&C[e].price&&(t[e].old_price=t[e].sale_price,t[e].sale_price=C[e].price,t[e].price_source="ali similar price")}),c()):chrome.runtime.sendMessage({type:"getCurrencyRates"},function(i){chrome.runtime.lastError&&chrome.runtime.lastError.message,i?$.each(t,function(a,c){var l=d({cur:c.base_app_cur});if(C[a]&&C[a].price&&-1!==n.indexOf(l)){var s,p=t[a].sale_price,_="similar "+e+" "+C[a].price+", el base "+l;e===l?s=C[a].price:l===r?(s=C[a].price/o,_+=", cur prod rate "+o):i[e]&&i[e][l]&&("RUB"===l?(s=C[a].price/i[e][l],_+=", base rub, api rate "+i[e][l]):"USD"===l&&"RUB"===e?(s=C[a].price*(1/i.USD.RUB),_+=", "+e+" -> "+l+", calc rate "+1/i.USD.RUB):(s=C[a].price*i[e][l],_+=", "+e+" -> "+l+", api rate "+i[e][l])),s&&+s?(k===l?p=Math.ceil(1*(100*s.toFixed(3)).toFixed(6))/100:(p=Math.ceil(100*(s*i[l][k]).toFixed(3))/100,_+=", "+l+" -> "+k+", api rate "+i[l][k]),t[a].old_price=t[a].sale_price,t[a].sale_price=p):_+=", no base price",t[a].price_source=_}}):re("no currencyRates data",y,207),c()}):i.resolve(t)}catch(e){i.resolve(t);var l="similar convert currency catch "+e;re(l,y,210,{message:"product_data.similar.error",params:{error:l,item:y}})}return i.promise()})(t).done(function(e){i(e)})})}T&&M(),$(window).on("tabShowed",function(){i.find("#similar_block_content").is(":visible")&&(T||M(),s({category:"Plugin content",action:"click",label:"Similar tab show"}),w=!0)})}(),ee({prodId:y,cb:function(e){var t=$(".alihelper_plugin_wrap");!function(e,t,i){if(!e||!e.item)return i(),!1;g&&(i(t,e),x());var a,r,o,c=$(".alihelper_plugin_wrap .follow_price_block"),l=t[0]||!1,s=(new Date).setHours(0,0,0,0),p=l.date&&new Date(Date.parse(l.date)).setHours(0,0,0,0)||s,u=l.price||"",m=l.cur||"",h=(new Date).getTime(),f=$('<span id="alihelper-aliRunParams">').hide(),v=e.item&&(e.item.base_sale_price&&+e.item.base_sale_price||e.item.base_original_price&&+e.item.base_original_price),w=e.item&&d({app_cur:e.item.base_app_cur}),b=e.item&&e.item.currency_rate&&+e.item.currency_rate;function k(){if(a!==m&&P){var c=!1,l=Math.ceil(100*(r*b).toFixed(3))/100;r&&r!==l&&(c=l||u),d(c)}else a===m?d(r||u):d();function d(c){if(c&&(!P||-1!==n.indexOf(a))&&(p<s||+o!=+c||t.length<2)){var l={price:+c,date:new Date,cur:m};e&&e.item&&e.item.currency_rate&&(l.currency_rate=+e.item.currency_rate),t.unshift(l),e&&e.item&&e.item.customHistory&&(e.item.customHistory=t),Math.abs(+o-+c)>.01&&(e.item.sale_price=+c),P?v&&w&&w===a&&(Math.abs(+v-+r)>.01&&te(function(){},y,w),M&&chrome.storage.local.get({cachedPrices:!1},function(e){!1===e.cachedPrices&&(e.cachedPrices={});var t=!1;e.cachedPrices[y]&&(t=e.cachedPrices[y].price),(!e.cachedPrices[y]||+t!=+v&&+t!=+r)&&(e.cachedPrices[y]={cur:w,price:+r,date:new Date(l.date).toString()}),chrome.storage.local.set(e)})):+o!=+c&&te(function(){},y)}e.item.priceChange=x(),i(t,e)}}function x(){var t=$(".alihelper_plugin_wrap .plugin_body--button"),i=_(e,!0),a=i&&i.priceChange||0,r=t.find(".price_tooltip");return r.find(".price_tooltip_text"),r.hasClass("price_tooltip--done")||(e.item&&a<0?t.addClass("plugin_body--price_down"):e.item&&a>0?t.addClass("plugin_body--price_up"):t.addClass("plugin_body--price_not_changed"),t.attr("data-change",a),r.addClass("price_tooltip--done").removeClass("loading")),a}(function(){var e=$.Deferred(),t=!1;try{f.on("runParamsDataReady",function(){t=JSON.parse(f.html()),e.resolve(t),f.remove()}),c.append(f);var i=document.head||document.documentElement,a=document.createElement("script");a.innerHTML="(function() { var f = "+function(){var e=window.skuProducts||[],t=window.runParams,i=t&&{actMinPrice:t.actMinPrice,minPrice:t.minPrice,currencyRate:t.currencyRate,baseCurrencyCode:t.baseCurrencyCode,currencyType:t.currencyType,productId:t.productId};if(!i.actMinPrice&&!i.minPrice)for(var a=document.querySelectorAll(".p-price[itemprop=price]")[0]&&document.querySelectorAll(".p-price[itemprop=price]")[0].innerHTML,r=0;r<e.length;r++){var n=e[r]&&e[r].skuVal&&e[r].skuVal.skuPrice;if(!n||!a)break;var o=a.replace(/[^0-9]/g,""),c=n.replace(/[^0-9]/g,"");if(-1!==c.indexOf(o)){i.minPrice=n.replace(/[^0-9.]/g,"");break}}var l=document.getElementById("alihelper-aliRunParams");l&&(l.innerHTML=JSON.stringify(i),l.dispatchEvent(new CustomEvent("runParamsDataReady")))}+"; f.apply(this); })();",i.appendChild(a),i.removeChild(a)}catch(t){throw e.resolve(!1),t}return e.promise()})().done(function(c){if(l&&c&&p<h)if(a=c.baseCurrencyCode,r=c.actMinPrice||c.minPrice,o=+l.price,!b&&c.currencyRate&&(b=c.currencyRate),y&&(!r||r&&a!=m&&!P||P&&-1===n.indexOf(a))){var s=$.ajax({url:"https://m.aliexpress.com/ajaxapi/product/ajaxDetail.do?productId="+y,type:"get",cache:!1,async:!0,crossDomain:!0,dataType:"json",timeout:8e3});s.done(function(e){if(e&&200===e.errorCode&&e.mobileProductDetailResult){var t=e.mobileProductDetailResult.msiteActivityOption||e.mobileProductDetailResult.activityOption||e.mobileProductDetailResult.priceOption[0],i=t&&(t.actMinAmount||t.minAmount),n=i&&i.currency,o=i&&i.value;n&&o?(r=o,a=n):(r=u,a=m)}k()}),s.fail(function(){k()})}else k();else i(t,e),x()})}(e,u(e),function(e,i){t.find(".plugin_body--button").hasClass("plugin_body--price_up")?t.find(".price_dynamics").addClass("price_dynamics--up"):t.find(".price_dynamics").addClass("price_dynamics--down"),!e||e.length<2?(t.find(".alihelper-price-chart").removeClass("loading").addClass("no_data").html('<span class="no_data_msg">'+l("c_no_history")+"</span>"),i&&re("no history",y,202,{message:"product_data.api_items.error",params:{error:"no history",item:y}})):($("#alihelperPriceChart").is(":visible")&&c(e,i),$(window).on("tabShowed",function(){c(e,i)})),r.resolve({productData:i,priceHistoryData:e}),t.find(".title_block--watchlist").length>0&&(z=t.find(".title_block--watchlist").find(".ali_custom_select").not(".inited").niceSelect()),Z(function(e){i?(q(i.inWishlist),E.click(function(){var e=$(this);if(e.hasClass("follow_price--loading"))return!1;e.addClass("follow_price--loading");var t=$("#goods_block_content");0===t.find(".goods_item.loading").length&&(t.addClass("loading"),J.next(".my_products_select").addClass("disabled"));var i=e.hasClass("alihelper_watchlist_add_product"),a=$(".follow_price_block .follow_price.beh_price").hasClass(".follow_price--added")?"Unfollow":"Follow";i&&(a+=" from watchlist tab"),s({category:"Plugin content",action:"click",label:a+" button click"}),ne(y,function(i){Z(function(a){if(i?q(i.curState,e):(t.find(".follow_price").hide(),$(".alihelper_watchlist_add_product").hide()),i.curState){var r="none"==$(".alihelper_plugin_wrap .my_products_select li[data-value=price_down]").css("display");oe("all"),r&&$(".alihelper_plugin_wrap .my_products_select li[data-value=price_down]").hide()}1===a.length&&1==i.curState&&b._show(2)})})})):(E.hide(),t.find(".follow_price_info").addClass("no_data").html(l("c_no_history")),t.find(".price_tooltip").removeClass("loading").addClass("no_data"),(!e||"ajax_error"===e||e&&0==e.length)&&(e&&0==e.length&&t.find(".follow_price_info").addClass("empty_watchlist_resp"),X([],!0))),$(J).on("change",function(){$(this).val(),F.length>0&&X(F,!0)})})})}})}})}function q(e,t){void 0===t&&(t=E);var i=l("c_untrack_price"),a=l("c_track_price"),r=l("c_track_price_watchlist"),n=l("c_untrack_price_watchlist");$(t).each(function(t,o){$(o).addClass("follow_price--added").addClass("follow_price--loading"),1==e?($(o).addClass("follow_price--added").removeClass("follow_price--loading").find(".text").text(i),$(o).find(".follow_price_tooltip").text(n)):($(o).removeClass("follow_price--added").removeClass("follow_price--loading").find(".text").text(a).find(".follow_price_tooltip"),$(o).find(".follow_price_tooltip").text(r))})}function Z(e){var t={type:"getList",lang:x},i=$("#goods_block_content");0===i.find(".goods_item.loading").length&&(i.addClass("loading"),J.next(".my_products_select").addClass("disabled")),P&&(t.currency=k),chrome.runtime.sendMessage(t,function(t){chrome.runtime.lastError&&chrome.runtime.lastError.message,t&&"ajax_error"!==t?t=t.reverse():!t&&re("no watchlist data",y,205,{message:"product_data.api_watchlists.error",params:{error:"no watchlist data",item:y}}),Q(t,function(t){X(t),e(t)})})}"#helper_my_products"==window.location.hash&&$(".alihelper_plugin_wrap select.my_products_select option[value=price_down]").attr("selected","selected").prop("selected",!0).trigger("change");var W=!1,G=!1,Y=[],V=!1,K=!1;function X(e,t){var i=$("#goods_block_content"),a=i.find(".ss-content").scrollTop(),r=0,n="ajax_error"===e||!e||0===e.length&&$(".alihelper_plugin_wrap .follow_price_info").hasClass("no_data");t&&s({category:"Plugin content",action:"show",label:"Watchlist select filter "+J.find("option:selected").text()}),B=[],F=!n&&e||[];var o,c,u,m,h,g,f,v=n?0:e.length;if(v>0){G="price_down"==J.val(),W=G,V="price_asc"==J.val(),K="seller_rating"==J.val(),k(),0===r||1===Y.length?(W=!1,0===r&&($(".alihelper_plugin_wrap select.my_products_select option[value=all]").attr("selected","selected").prop("selected",!0),!t&&G&&oe("all"),k(),$(".alihelper_plugin_wrap .my_products_select li[data-value=price_down]").hide())):($(".alihelper_plugin_wrap .my_products_select li[data-value=price_down]").show(),$(".alihelper_plugin_wrap div.my_products_select").show()),W=G,-1===Y.indexOf(+y)?q(!1):q(!0);var w=[];function k(){Y=[],B=[];for(var t=0;t<v;t++){if(!e[t].item.id||!e[t].item.title&&""!==e[t].item.title||!e[t].item.image_url)return!1;var i=d(e[t].item),a=_(e[t]),n=a.priceChange;if(Y.push(e[t].item.id),n<0&&++r,!W||n&&null!==n&&!(n>=0)){var o={id:e[t].item.id,url:e[t].item.url,image_url:e[t].item.image_url,title:e[t].item.title,sale_price:e[t].item.sale_price,original_price:e[t].item.original_price,currency:i,seller_rating:void 0!==e[t].item.seller&&e[t].item.seller&&e[t].item.seller.score?e[t].item.seller.score:0,priceChange:n,priceChangeTxt:a.priceChangeText,priceChangeTooltipTxt:a.priceChangeTooltipTxt,priceChangeTimestamp:a.priceChangeTimestamp,priceFromCache:a.priceFromCache};e[t].item.promUrl&&(o.promUrl=e[t].item.promUrl),B.push(o)}}}$.each(H,function(e,t){t*=1,-1!==Y.indexOf(t)&&w.push(t)}),H=w,B.length>0&&(W&&B.sort(function(e,t){return e.priceChangeTimestamp>t.priceChangeTimestamp?-1:e.priceChangeTimestamp<t.priceChangeTimestamp?1:0}),V&&B.sort(function(e,t){var i=e.sale_price?e.sale_price:e.original_price,a=t.sale_price?t.sale_price:t.original_price;return+i<+a?-1:+i>+a?1:0}),K&&B.sort(function(e,t){return+e.seller_rating>+t.seller_rating?-1:+e.seller_rating<+t.seller_rating?1:0})),$(".alihelper_watchlist_add_product").addClass("watchlist_has_products")}else q(!1),$(".alihelper_watchlist_add_product").removeClass("watchlist_has_products");o=function(){i.hasClass("ss-container")?(SimpleScrollbar.reInitEl(i[0]),a&&i.find(".ss-content").scrollTop(a)):SimpleScrollbar.initEl(i[0]),n&&(i.find(".follow_price").hide(),$(".alihelper_watchlist_add_product").hide())},c=n,u=$("#goods_block_content"),m=$('<span class="goods_block_content--no_prod"><i class="add_product">'+l("c_my_products_empty_add")+'</i><span class="follow_price follow_price beh_price"><i class="icon"></i><span class="text">'+l("c_my_products_empty_add_button")+"</span></span></span>"),h=$('<span class="goods_block_content--no_prod goods_block_content--no_prod_cheaper">'+l("c_my_products_empty_cheaper")+"</span>"),g=$('<span class="goods_block_content--no_prod goods_block_content--no_prod--no_data">'+l("c_my_products_no_data")+"</span>"),(f=B.length)>0?$(".alihelper_plugin_wrap .my_products_count").text(" ("+f+")"):$(".alihelper_plugin_wrap .my_products_count").text(""),chrome.storage.local.get({priceChangeTimestamp:!1},function(e){if(Y.length>=1&&Y.length<=3?u.addClass("goods_block--3"):u.removeClass("goods_block--3"),u.off("mousedown.deep click.deep auxclick.deep").html(""),f>0){var t,i=0;t=!1===e.priceChangeTimestamp?(new Date).getTime():e.priceChangeTimestamp,$.each(B,function(e,a){var r=p(a.currency,a.sale_price||a.original_price),n="#open_price_history",o=a.promUrl?' data-prom="1" ':"",c=$('<a data-id="'+a.id+'" href="'+(a.promUrl||a.url)+n+'" data-href="'+a.url+n+'"'+o+'  class="goods_item goods_item--'+a.id+'"></a>'),l="";a.priceChangeTooltipTxt&&(l='<i class="price_tooltip_text">'+a.priceChangeTooltipTxt+"</i>"),c.append('<div class="goods_item_img"><img src="'+a.image_url+'" alt="'+a.title+'"></div><div class="goods_item_info"><div class="goods_item_name">'+a.title+'</div><div class="goods_item_price">'+(r?'<div class="price_str"><span class="price'+(0==a.priceChange?"":a.priceChange<=0?" decrease":" increase")+'">'+r+'</span> <span class="price_msg">'+a.priceChangeTxt+"</span></div>"+l:"")+"</div></div>"),-1!==H.indexOf(1*a.id)&&c.addClass("loading");var d=$('<span class="delete_item">×</span>');d.click(function(t){t.preventDefault(),t.stopPropagation(),B.splice(e,1),c.addClass("loading"),H.push(a.id),+a.id==+y&&E.addClass("follow_price--loading"),s({category:"Plugin content",action:"click",label:"Remove from watchlist link click"}),ne(a.id,function(e){Z(function(){var e=+a.id,t=H.indexOf(e);-1!==t&&H.splice(t,1)})})}),c.append(d),+a.id==+y&&c.click(function(e){void 0!==b&&(b._show(1),e.preventDefault(),e.preventDefault())}),c.click(function(e){s({category:"Plugin content",action:"click",label:"Watchlist product click"})}),u.append(c),+a.id!=+y&&!a.priceFromCache&&a.priceChangeTimestamp-t>18e4&&a.priceChange<0&&i++}),u.on("mousedown.deep",".goods_item",function(){var e=$(this);chrome.storage.local.get({cashbackUser:!1},function(t){!1!==t.cashbackUser&&e.attr("href",e.attr("data-href")).attr("data-prom","")})}).on("click.deep auxclick.deep",".goods_item",function(e){var t=$(this);return"auxclick"===e.type&&2!==e.which||!("click"!==e.type||!t.attr("data-id")||+t.attr("data-id")!=+y)||(t.attr("href")&&t.attr("href",t.attr("href").replace(/\?spm=([^#&]*)&/g,"?")),void("1"===t.attr("data-prom")&&chrome.runtime.sendMessage({type:"sendRedirectStat",promUrl:t.attr("href"),tabUrl:t.attr("data-href")})))}),i>0&&("#helper_my_products"==window.location.hash?chrome.storage.local.set({priceChangeTimestamp:(new Date).getTime()}):0==$(".alihelper_plugin_wrap .cheaper_count").length&&($(window).on("tabShowed",function(){$(".alihelper_plugin_wrap #goods_block_content").is(":visible")&&$(".alihelper_plugin_wrap .cheaper_count").hide()}),s({category:"Plugin content",action:"show",label:"Cheaper count circle show"}),$(".alihelper_plugin_wrap .price_tooltip").after($('<span class="cheaper_count">').text(i).click(function(e){e.preventDefault(),e.stopPropagation(),$(this).hide(),u.addClass("loading"),oe("price_down"),$(".alihelper_plugin_wrap .plugin_body--button").click(),void 0!==b&&b._show(2),s({category:"Plugin content",action:"click",label:"Cheaper count circle click"}),chrome.storage.local.set({priceChangeTimestamp:(new Date).getTime()},function(){ae()})})))),$(window).on("tabShowed",function(){$(".alihelper_plugin_wrap #goods_block_content").is(":visible")&&chrome.storage.local.set({priceChangeTimestamp:(new Date).getTime()},function(){ae()})}),u.removeClass("loading goods_block--empty"),o()}else{u.addClass("goods_block--empty").removeClass("loading goods_block--3"),W?u.html(h):u.html(m);var a=$(".alihelper_plugin_wrap .follow_price_info"),r=a.hasClass("no_data"),n=a.hasClass("empty_watchlist_resp");c||r?(c&&u.html(g),r&&n?(u.html(m),m.find(".follow_price").hide(),$(".alihelper_watchlist_add_product").hide()):(m.find(".follow_price, .add_product").hide(),$(".alihelper_watchlist_add_product").hide())):m.find(".follow_price").click(function(){$("#goods_block_content").addClass("loading"),J.next(".my_products_select").addClass("disabled"),s({category:"Plugin content",action:"click",label:"Follow button watchlist click"}),ne(y,function(e){Z(function(){var t=+y,i=H.indexOf(t);-1!==i&&H.splice(i,1),e&&q(e.curState,E)})})})}J.next(".my_products_select").removeClass("disabled")})}function Q(e,t){P&&M?chrome.storage.local.get({cachedPrices:!1},function(i){if(!1===i.cachedPrices)t(e);else{var a=i.cachedPrices,r=!1;e&&"ajax_error"!==e&&"object"==typeof e&&Object.keys(e).length>0?($.each(e,function(t,i){var n=i&&i.item?i.item:i||!1;if(n&&a&&a[n.id]){if(!n.price_validated_at&&n.customHistory&&n.customHistory.length>0){var o=n.customHistory[0];o.date&&(n.price_validated_at=o.date)}var c=d({app_cur:n.base_app_cur}),l=d({app_cur:n.app_cur});if(n.price_validated_at)if(new Date(n.price_validated_at)>new Date(a[n.id].date))r=!0,delete a[n.id];else if(c===a[n.id].cur&&l){var s=0;n.base_app_cur===n.app_cur?s=a[n.id].price:n.currency_rate&&+n.currency_rate&&(s=Math.ceil(100*(a[n.id].price*+n.currency_rate).toFixed(3))/100),s>0&&(e[t].item?(e[t].item.customHistory&&e[t].item.customHistory.unshift({cur:l,price:s,date:a[n.id].date,cached:!0}),e[t].item.sale_price=s):e[t].sale_price=s)}}}),!1===r?t(e):chrome.storage.local.set({cachedPrices:a},function(){t(e)})):t(e)}}):t(e)}function ee(e){var t=e.cb,i=void 0!==e.prodId?e.prodId:y,a={type:"checkProduct",prodId:i,lang:x};e.isSimilar&&(a.isSimilar=!0),P&&(a.currency=k),chrome.runtime.sendMessage(a,function(a){chrome.runtime.lastError&&chrome.runtime.lastError.message,a&&"ajax_error"!==a?t(a):(t(""),!a&&re("no checkProd data"+(e.isSimilar?" similar":""),i,206,{message:"product_data.api_items.error",params:{error:"no product data"+(e.isSimilar?" similar":""),item:i}}))})}function te(e,t,i){var a={type:"updateProduct",prodId:void 0!==t?t:y};P&&(a.currency=i||k),chrome.runtime.sendMessage(a,function(t){chrome.runtime.lastError&&chrome.runtime.lastError.message,s({category:"Plugin content",action:"action",label:"Update product"}),t&&e(t)})}var ie=!1;function ae(){if(ie)return!1;ie=!0,chrome.runtime.sendMessage({type:"removeNotifications"},function(){chrome.runtime.lastError&&chrome.runtime.lastError.message})}function re(e,t,i,a){chrome.runtime.sendMessage({type:"sendErrorAnalytics",message:e,prodId:void 0!==t?t:y,tab_url:document.location.href,errorCode:i,apiError:a},function(){chrome.runtime.lastError&&chrome.runtime.lastError.message})}function ne(e,t){var i;$(".goods_item--"+e).addClass("loading"),i={type:"addDelProduct",prodId:void 0!==e?e:y},P&&(i.currency=k),chrome.runtime.sendMessage(i,function(e){chrome.runtime.lastError&&chrome.runtime.lastError.message,e&&"ajax_error"!==e?t(e):(t(),!e&&re("no addDelProduct data",y,208,{message:"product_data.api_watchlists.error",params:{error:"no data",item:y}}))})}function oe(e){$(".alihelper_plugin_wrap select.my_products_select option[value="+e+"]").attr("selected","selected").prop("selected",!0).trigger("change"),z.niceSelect("update")}}),"#helper_howto"===window.location.hash&&v();var f;function v(){$(".alihelper_content_popup_wrap--howto").remove();var e=$(window).width()>960&&$(window).height()>550?853:640,t=$(window).width()>960&&$(window).height()>550?480:360,i=$('<div class="alihelper_content_popup_wrap alihelper_content_popup_wrap--howto"></div>').click(function(e){i.remove(),e.stopPropagation()}).html('<div class="alihelper_content_popup alihelper_content_popup--howto"><iframe width="'+e+'" height="'+t+'" src="https://www.youtube.com/embed/NUZKbyKVnv4?autoplay=1" frameborder="0" allowfullscreen></iframe></div>').hide(),a=i.find(".alihelper_content_popup");function r(){$(window).width()<$(a).width()+70?a.addClass("stick_left"):a.removeClass("stick_left"),$(window).height()<$(a).height()+70?a.addClass("stick_top"):a.removeClass("stick_top")}a.click(function(e){e.stopPropagation()}).prepend($('<span class="alihelper_content_popup_close">&times;</span>').click(function(){i.remove()})),$("body").append(i.show()),r(),$(window).resize(r)}function w(e){return e.toString().split("&").reduce(function(e,t){var i=t.split("=").map(function(e){return decodeURIComponent(e.replace("+"," "))});return e[i[0]]=i[1],e},{})}if(k=document.location.href,-1===k.indexOf("login.aliexpress.com")&&(k.indexOf("/order/pay_online_result")>0||k.indexOf("/order/payOnlineSuccess")>0||k.indexOf("confirm_order")>0)&&($(".error-page").length||chrome.storage.local.get({utm_url:!1,extensionId:!1,cashbackUser:!1,cashbackUtmMatched:!1,cashbackMaskMatched:!1,cashbackSkMatched:!1,tracking_id:!1,cashbackId:!1,clickId:!1},function(e){var t="";if(void 0!==chrome.runtime.getManifest){var i=chrome.runtime.getManifest();t=i.version}$.ajax({url:"https://aliexpress-checker.ru/analytics",type:"post",dataType:"json",cache:!1,async:!0,crossDomain:!0,data:{url:k,sk:function(e){for(var t=e+"=",i=decodeURIComponent(document.cookie).split(";"),a=0;a<i.length;a++){for(var r=i[a];" "==r.charAt(0);)r=r.substring(1);if(0==r.indexOf(t))return r.substring(t.length,r.length)}return""}("aeu_cid"),tracking_id:e.tracking_id,utm_url:e.utm_url,extensionId:e.extensionId,cashbackUser:e.cashbackUser,cashbackUtmMatched:e.cashbackUtmMatched,cashbackMaskMatched:e.cashbackMaskMatched,cashbackSkMatched:e.cashbackSkMatched,cashbackId:e.cashbackId,extensionVersion:t,clickId:e.clickId}})})),void 0!==chrome.runtime.getManifest&&void 0!==chrome.runtime.id){var b=setInterval(function(){try{if(void 0!==chrome.runtime.id)return;if(clearInterval(b),$("body").attr("data-loadCheckTimestamp")!=h)return;y()}catch(e){if(clearInterval(b),$("body").attr("data-loadCheckTimestamp")!=h)return;y()}},3500);function y(){$(".alihelper_plugin_wrap, .ali-rating-wrap, .alihelper_settings_wrap").remove()}}var k}(),chrome.storage.local.get({analyticsFromAliPage:!1},function(e){var t=e.analyticsFromAliPage,i=[],a=0;if(!1!==t&&t){try{for(var r=0;r<t.length;r++)n(t[r]);setTimeout(function(){i.length>0&&chrome.runtime.sendMessage({type:"analyticsFromAliPage",data:{tab_url:document.location.href,data:i}},function(){chrome.runtime.lastError&&chrome.runtime.lastError.message})},a+1e3)}catch(e){}function n(e){if(!e||!e.selector)return!1;var t=e.insertTimeout||0;setTimeout(function(){try{var t,a=$(e.selector).html(),r=e.selector_2&&$(e.selector_2).html(),n=e.selector_3&&$(e.selector_3).html(),o={};function c(i){var c="";i&&(c="_"+i);var l,s=e["valueregexp"+c].index?e["valueregexp"+c].index:0;if(i?2===i?l=r:3===i&&(l=n):l=a,(t=l.match(new RegExp(e["valueregexp"+c].match,"g")))&&t[s]){var d=t[s];e["valuereplace"+c]&&$.each(e["valuereplace"+c],function(e,t){d=d.replace(new RegExp(t.find,"g"),t.replace)}),o.title=e.title,o["val"+c]=d,!0!==e["no_raw"+c]&&(o["raw_val"+c]=l)}}a&&e.valueregexp&&c(),r&&e.valueregexp_2&&c(2),n&&e.valueregexp_3&&c(3),o.title&&o.val&&i.push(o)}catch(e){}},t),a=Math.max(a,t)}}})})})})}();